<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
    <title>Conversaci√≥n</title>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="chat.css" /> 
    <link rel="icon" href="favicon.ico" />

    <script src="/socket.io/socket.io.js"></script>
</head>
<body>

<script>
    // L√≥gica de redirecci√≥n a login si no hay usuario
    const currentUser = sessionStorage.getItem("currentUser");
    if (!currentUser) {
        window.location.href = "login.html"; 
    }
    
    // ‚úÖ CORRECCI√ìN CLAVE: L√≥gica para asegurar que hay un chat seleccionado
    // Verifica que el par√°metro 'chatKey' exista en la URL, que es lo que menu.js env√≠a.
    const chatKey = new URLSearchParams(window.location.search).get('chatKey');
    if (!chatKey) {
        window.location.href = "menu.html"; 
    }
</script>


<div class="app-container">
    
    <section class="screen active" id="chatScreen">
        
        <div class="chat-header">
            <button id="backToMain" class="back-btn" aria-label="Volver al men√∫">‚Üê</button>
            <div class="partner-info">
                <div id="partnerName" class="partner-name">Nombre del Chat</div>
                <div id="partnerStatus" class="partner-status">Estado de la pareja</div>
            </div>
            <button id="openMoodModalChat" class="my-mood-btn" aria-label="Cambiar estado emocional">üò¥</button> 
        </div>

        <div id="messageContainer" class="message-container">
            </div>

        <div id="replyingToContainer" class="reply-context">
            <span id="replyingToText"></span>
            <button id="cancelReplyBtn" class="btn small">X</button>
        </div>

        <div class="input-area">
            <textarea id="messageInput" placeholder="Escrib√≠ un mensaje..." rows="1"></textarea>
            <button id="sendMessageBtn" class="btn primary" disabled>Enviar</button>
        </div>
        
    </section>
    
    <div id="messageActionsModal" class="modal-backdrop">
        <div class="modal-content">
            <button class="close-modal-btn" data-modal-target="messageActionsModal" aria-label="Cerrar modal">X</button>
            <h3>Mensaje Seleccionado</h3>
            <p id="selectedMessageText">Texto del mensaje...</p>
            <div class="action-buttons">
                <button id="replyMessageBtn" class="btn">‚Ü©Ô∏è Responder</button>
                <button id="markImportantBtn" class="btn">üåü Marcar como importante</button>
            </div>
            <button class="btn secondary close-modal-btn" data-modal-target="messageActionsModal">Cerrar</button>
        </div>
    </div>
    
</div>

<script src="chat.js"></script>
</body>
</html>